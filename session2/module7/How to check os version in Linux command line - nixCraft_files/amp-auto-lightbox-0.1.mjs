(self.AMP=self.AMP||[]).push({n:"amp-auto-lightbox",ev:"0.1",l:true,v:"2106030132000",m:1,f:function(AMP,_){let g;class k{constructor(){this.promise=new Promise(((a,b)=>{this.resolve=a;this.reject=b}))}}function p(a){return a?Array.prototype.slice.call(a):[]}let q=self.AMP_CONFIG||{},r=("string"==typeof q.cdnProxyRegex?new RegExp(q.cdnProxyRegex):q.cdnProxyRegex)||/^https:\/\/([a-zA-Z0-9_-]+\.)?cdn\.ampproject\.org$/;function t(a){if(self.document&&self.document.head&&(!self.location||!r.test(self.location.origin))){var b=self.document.head.querySelector(`meta[name="${a}"]`);b&&b.getAttribute("content")}}q.cdnUrl||t("runtime-host");q.geoApiUrl||t("amp-geo-api");self.__AMP_LOG=self.__AMP_LOG||{user:null,dev:null,userForEmbed:null};function u(a,b){a=a.__AMP_TOP||(a.__AMP_TOP=a);return w(a,b)}function x(a,b){var c=y(a);c=z(c);return w(c,b)}function y(a){return a.nodeType?u((a.ownerDocument||a).defaultView,"ampdoc").getAmpDoc(a):a}function z(a){a=y(a);return a.isSingleDoc()?a.win:a}function w(a,b){A(a,b);let c=a.__AMP_SERVICES;c||(c=a.__AMP_SERVICES={});a=c[b];a.obj||(a.obj=new a.ctor(a.context),a.context=null,a.resolve&&a.resolve(a.obj));return a.obj}function A(a,b){a=a.__AMP_SERVICES&&a.__AMP_SERVICES[b];return!(!a||!a.ctor)}
/* https://mths.be/cssescape v1.5.1 by @mathias | MIT license */
function B(a,b){for(;a&&void 0!==a;a=a.parentElement)if(b(a))return a;return null}function G(a){return a.closest?a.closest("a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):B(a,(b=>{let c=b.matches||b.webkitMatchesSelector||b.mozMatchesSelector||b.msMatchesSelector||b.oMatchesSelector;return c?c.call(b,"a[href],amp-script,amp-story,button,amp-lightbox,amp-carousel,[placeholder],[data-amp-auto-lightbox-disable],amp-selector [option],[subscriptions-action]"):!1}))}let H={bubbles:!0,cancelable:!0};function I(a){a.tagName.startsWith("AMP-");if(a.createdCallback)return Promise.resolve(a);if(!a.__AMP_UPG_PRM){let b=new k;a.__AMP_UPG_PRM=b.promise;a.__AMP_UPG_RES=b.resolve}return a.__AMP_UPG_PRM}/nochunking=1/.test(self.location.hash);(function(){return g?g:g=Promise.resolve(void 0)})();function J(a,b){var c={needsRootBounds:!1};let e=c.needsRootBounds;return new b.IntersectionObserver(a,{threshold:c.threshold,root:b.parent&&b.parent!=b&&e?b.document:void 0})}new WeakMap;new WeakMap;let K,L;function M(a){K||(K=new WeakMap,L=new WeakMap);let b=L.get(a);b||(b=J((c=>{let e=new Set;for(let d=c.length-1;0<=d;d--){let{target:f}=c[d];e.has(f)||(e.add(f),b.unobserve(f),K.get(f).resolve(c[d]),K.delete(f))}}),a),L.set(a,b));return b}function N(a){if(K&&K.has(a))return K.get(a).promise;M(a.ownerDocument.defaultView).observe(a);let b=new k;K.set(a,b);return b.promise}let O={Article:!0,NewsArticle:!0,BlogPosting:!0,LiveBlogPosting:!0,DiscussionForumPosting:!0},P=()=>{},Q=/\s+([0-9]+)w(,|[\S\s]*$)/g;function R(a){return x(a,"mutator").mutateElement(a,(()=>{a.setAttribute("i-amphtml-auto-lightbox-visited","")}))}function S(a){return I(a).then((b=>b.signals().whenSignal("load-end")))}function T(a){return p(a.getRootNode().querySelectorAll('script[type="application/ld+json"]')).map((b=>{try{var c=JSON.parse(b.textContent)}catch(e){void 0,c=null}return(c||{})["@type"]})).filter(Boolean)}function U(a){return T(a).some((b=>O[b]))}function V(a){let b=c=>!!a.getRootNode().querySelector(c);return b('script[custom-element="amp-lightbox-gallery"]')&&b("[lightbox]:not([i-amphtml-auto-lightbox-visited])")}let W=0;function X(a,b){return x(a,"mutator").mutateElement(b,(()=>{b.setAttribute("lightbox",`i-amphtml-auto-lightbox-${W++}`)})).then((()=>{u(a.win,"extensions").installExtensionForDoc(a,"amp-lightbox-gallery");let c=b.ownerDocument.createEvent("Event");c.data={};let{bubbles:e,cancelable:d}=H;c.initEvent("amp-auto-lightbox:newly-set",e,d);b.dispatchEvent(c);return b}))}function Y(a,b){b.map((c=>S(c).then((()=>N(c).then((({boundingClientRect:e})=>{var d;if(d=c.signals().get("load-end")){d=e.width;var f=e.height,l=c.querySelector("img"),h=l.naturalHeight;let v=l.naturalWidth,aa=v/h;var m=-1;if(l=l.getAttribute("srcset"))for(var n;n=Q.exec(l);)n=parseInt(n[1],10),n>m&&(m=n);let{naturalHeight:C,naturalWidth:D}=m>v?{naturalWidth:m,naturalHeight:m/aa}:{naturalWidth:v,naturalHeight:h};h=x(c,"viewport");let{height:E,width:F}=h.getSize();d*=f;f=.25<=d/(F*E);h=D>F||C>E;if(d=1.2<=D*C/d||h||f)G(c)?d=!1:(d=y(c),d=z(d),d=!(A(d,"action")?w(d,"action"):null).hasResolvableAction(c,"tap"))}if(d)return X(a,c)}))),P)))}function Z(a,b){if(V(a))var c=0;else c=(c=a.getRootNode().querySelector('meta[property="og:type"]'))?c.getAttribute("content"):void 0,c="article"==c||U(a);c&&(c=p((b||a.win.document).querySelectorAll("amp-img:not([lightbox]):not([i-amphtml-auto-lightbox-visited])")),c.forEach(R),Y(a,c))}(a=>{let b=a.ampdoc;b.whenReady().then((()=>{b.getRootNode().addEventListener("amp:dom-update",(c=>{Z(b,c.target)}));Z(b)}))})(self.AMP)}});//# sourceMappingURL=amp-auto-lightbox-0.1.mjs.map